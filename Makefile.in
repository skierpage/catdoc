# Your C compilier and flags
SHELL = /bin/sh
INSTALL = @INSTALL@
PACKAGE_VERSION = @PACKAGE_VERSION@
PACKAGE_TARNAME = @PACKAGE_TARNAME@
installroot=@installroot@
prefix = @prefix@
mandir = @mandir@
tardir=${PACKAGE_TARNAME}-${PACKAGE_VERSION}

all:
	set -e;\
	for i in src charsets; do\
	   (cd $$i; $(MAKE) all);\
	done

# TODO: shold I use $(INSTALL) -d here or ../mkinstalldirs ?
install-man:
	$(INSTALL) -d $(DESTDIR)$(installroot)$(mandir)/man1
	$(INSTALL) -m 644 doc/*.1 $(DESTDIR)$(installroot)$(mandir)/man1

distclean-man:
	$(RM) doc/*.1

install: install-man
	set -e;\
	for i in src charsets; do\
	   (cd $$i; $(MAKE) install);\
	done
clean:
	set -e;\
	for i in src charsets tests; do\
	   (cd $$i; $(MAKE) clean);\
	done
distclean: distclean-man
	set -e;\
	for i in src charsets tests; do\
	   (cd $$i; $(MAKE) distclean);\
	done
	rm -f Makefile config.*
dist:
	$(MAKE) clean
	mkdir $(tardir)
	cp -rp src doc charsets tests $(tardir)
	cp -rp install-sh missing mkinstalldirs CODING.STD COPYING CREDITS $(tardir)
	cp -rp INSTALL Makefile Makefile.in NEWS README.md TODO.md $(tardir)
	cp -rp acconfig.h configure configure.in $(tardir)
	$(MAKE) -C $(tardir) distclean
	tar cf $(tardir).tar $(tardir)
	gzip -c $(tardir).tar > $(tardir).tar.gz
	rm -rf $(tardir)

check:
	set -e;\
	(cd tests; $(MAKE) check);
