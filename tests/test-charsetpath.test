#!/bin/bash
# Test CHARSETPATH environment variable functionality
# This test verifies that catdoc respects the CHARSETPATH environment variable

set -e

TOOL="../src/catdoc"
EXPECTEDFILE="test_charsetpath.expected"

# Check if tool exists
if [ ! -x "$TOOL" ]; then
    echo "ERROR: Required tool not found: $TOOL" >&2
    echo "Did you run 'make' first?" >&2
    exit 1
fi

# Check if expected output file exists
if [ ! -f "$EXPECTEDFILE" ]; then
    echo "ERROR: Expected output file not found: $EXPECTEDFILE" >&2
    exit 1
fi

# Run catdoc -l with CHARSETPATH pointing to test_charsets directory
# This should list only the charset files in that directory plus built-in utf-8
if CHARSETPATH=test_charsets "$TOOL" -l | diff -u --ignore-blank-lines --ignore-trailing-space "$EXPECTEDFILE" - >/dev/null 2>&1; then
    exit 0
else
    echo "FAIL: test_charsetpath (output differs from expected)" >&2
    CHARSETPATH=test_charsets "$TOOL" -l | diff -u --ignore-blank-lines --ignore-trailing-space "$EXPECTEDFILE" - >&2 || true
    exit 1
fi
